import{b as e}from"./chunk-3SGZP5CP.js";import{a as d}from"./chunk-RR4FM5OT.js";import{a as k}from"./chunk-YAR2KJ42.js";import{a as N}from"./chunk-SSNWR7WF.js";import{c as p}from"./chunk-4NFNYA6L.js";import{a as b}from"./chunk-KZR7TQ7H.js";import{a as w}from"./chunk-OC3TXL2V.js";import{l as f,m as E}from"./chunk-IQEG76GP.js";import{j as m,m as T}from"./chunk-HBP5N4FR.js";T();import{useCallback as S,useEffect as C,useRef as I}from"react";import{io as D}from"socket.io-client";w();var y=3e3,O=3,A=500,W=1e3,R="batchUpdated",U="connect",_="disconnect";function H(){let o=I(null),c=I(null),{address:n}=N(),r=p(),{network:s}=d(),g=t=>{o.current&&clearTimeout(o.current),o.current=setTimeout(()=>{r(f(t))},W)},h=t=>{c.current&&clearTimeout(c.current),c.current=setTimeout(()=>{r(E(t))},W)},i=()=>{var t;(t=e.current)==null||t.close(),e.current=null,e.status="not_initialized",o.current&&clearTimeout(o.current)},u=S(b(()=>m(this,null,function*(){var a;if(!n)return;e.status="pending";let t=(a=s.websocketUrl)!=null?a:yield k(s.apiAddress);if(t==null){console.warn("Can not get websocket url");return}e.current=D(t,{forceNew:!0,reconnectionAttempts:O,timeout:y,query:{address:n}}),e.status="completed",e.current.onAny(g),e.current.on(R,h),e.current.on(U,()=>{console.log("Websocket connected.")}),e.current.on(_,()=>{n&&(console.warn("Websocket disconnected. Trying to reconnect..."),setTimeout(()=>{var l;n&&(console.log("Websocket reconnecting..."),(l=e.current)==null||l.connect())},A))})}),{retries:2,delay:A}),[n]);C(()=>{var t;if(n&&e.status==="not_initialized"&&!((t=e.current)!=null&&t.active)){u();return}n||i()},[n,u]),C(()=>()=>{i()},[])}export{H as a};
//# sourceMappingURL=chunk-NTQNJKLZ.js.map

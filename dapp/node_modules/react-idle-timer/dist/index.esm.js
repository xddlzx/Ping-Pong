var rt=Object.create,Te=Object.defineProperty;var nt=Object.getOwnPropertyDescriptor;var ot=Object.getOwnPropertyNames;var it=Object.getPrototypeOf,st=Object.prototype.hasOwnProperty;var at=t=>Te(t,"__esModule",{value:!0});var ut=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var ct=(t,e,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of ot(e))!st.call(t,r)&&r!=="default"&&Te(t,r,{get:()=>e[r],enumerable:!(o=nt(e,r))||o.enumerable});return t},lt=t=>ct(at(Te(t!=null?rt(it(t)):{},"default",t&&t.__esModule&&"default"in t?{get:()=>t.default,enumerable:!0}:{value:t,enumerable:!0})),t);var Ae=ut((ie,Le)=>{(function(t,e){typeof ie=="object"&&typeof Le!="undefined"?e(ie):typeof define=="function"&&define.amd?define(["exports"],e):(t=typeof globalThis!="undefined"?globalThis:t||self,e(t.fastUniqueNumbers={}))})(ie,function(t){"use strict";var e=function(c){return function(f){var d=c(f);return f.add(d),d}},o=function(c){return function(f,d){return c.set(f,d),d}},r=Number.MAX_SAFE_INTEGER===void 0?9007199254740991:Number.MAX_SAFE_INTEGER,l=536870912,T=l*2,W=function(c,f){return function(d){var S=f.get(d),w=S===void 0?d.size:S<T?S+1:0;if(!d.has(w))return c(d,w);if(d.size<l){for(;d.has(w);)w=Math.floor(Math.random()*T);return c(d,w)}if(d.size>r)throw new Error("Congratulations, you created a collection of unique numbers which uses all available integers!");for(;d.has(w);)w=Math.floor(Math.random()*r);return c(d,w)}},j=new WeakMap,Z=o(j),a=W(Z,j),n=e(a);t.addUniqueNumber=n,t.generateUniqueNumber=a,Object.defineProperty(t,"__esModule",{value:!0})})});function mt(t){return function(o){let r={...o};!r.onPrompt&&t.prototype.onPrompt&&(r.onPrompt=()=>{t.prototype.onPrompt()}),!r.onIdle&&t.prototype.onIdle&&(r.onIdle=()=>{t.prototype.onIdle()}),!r.onActive&&t.prototype.onActive&&(r.onActive=T=>{t.prototype.onActive(T)}),!r.onAction&&t.prototype.onAction&&(r.onAction=T=>{t.prototype.onAction(T)});let l=Y(r);return React.createElement(t,{...o,...l})}}import{useEffect as _,useRef as p,useCallback as b}from"react";var K=lt(Ae());var Oe=t=>t.method!==void 0&&t.method==="call";var De=t=>t.error===null&&typeof t.id=="number";var Ce=t=>{let e=new Map([[0,()=>{}]]),o=new Map([[0,()=>{}]]),r=new Map,l=new Worker(t);return l.addEventListener("message",({data:a})=>{if(Oe(a)){let{params:{timerId:n,timerType:u}}=a;if(u==="interval"){let c=e.get(n);if(typeof c=="number"){let f=r.get(c);if(f===void 0||f.timerId!==n||f.timerType!==u)throw new Error("The timer is in an undefined state.")}else if(typeof c!="undefined")c();else throw new Error("The timer is in an undefined state.")}else if(u==="timeout"){let c=o.get(n);if(typeof c=="number"){let f=r.get(c);if(f===void 0||f.timerId!==n||f.timerType!==u)throw new Error("The timer is in an undefined state.")}else if(typeof c!="undefined")c(),o.delete(n);else throw new Error("The timer is in an undefined state.")}}else if(De(a)){let{id:n}=a,u=r.get(n);if(u===void 0)throw new Error("The timer is in an undefined state.");let{timerId:c,timerType:f}=u;r.delete(n),f==="interval"?e.delete(c):o.delete(c)}else{let{error:{message:n}}=a;throw new Error(n)}}),{clearInterval:a=>{let n=(0,K.generateUniqueNumber)(r);r.set(n,{timerId:a,timerType:"interval"}),e.set(a,n),l.postMessage({id:n,method:"clear",params:{timerId:a,timerType:"interval"}})},clearTimeout:a=>{let n=(0,K.generateUniqueNumber)(r);r.set(n,{timerId:a,timerType:"timeout"}),o.set(a,n),l.postMessage({id:n,method:"clear",params:{timerId:a,timerType:"timeout"}})},setInterval:(a,n)=>{let u=(0,K.generateUniqueNumber)(e);return e.set(u,()=>{a(),typeof e.get(u)=="function"&&l.postMessage({id:null,method:"set",params:{delay:n,now:performance.now(),timerId:u,timerType:"interval"}})}),l.postMessage({id:null,method:"set",params:{delay:n,now:performance.now(),timerId:u,timerType:"interval"}}),u},setTimeout:(a,n)=>{let u=(0,K.generateUniqueNumber)(o);return o.set(u,a),l.postMessage({id:null,method:"set",params:{delay:n,now:performance.now(),timerId:u,timerType:"timeout"}}),u}}};var Q=null,Ne=(t,e)=>()=>{if(Q!==null)return Q;let o=new Blob([e],{type:"application/javascript; charset=utf-8"}),r=URL.createObjectURL(o);return Q=t(r),Q.setTimeout(()=>URL.revokeObjectURL(r),0),Q};var _e=`(()=>{"use strict";const e=new Map,t=new Map,r=(e,t)=>{let r,o;const i=performance.now();r=i,o=e-Math.max(0,i-t);return{expected:r+o,remainingDelay:o}},o=(e,t,r,i)=>{const s=performance.now();s>r?postMessage({id:null,method:"call",params:{timerId:t,timerType:i}}):e.set(t,setTimeout(o,r-s,e,t,r,i))};addEventListener("message",(i=>{let{data:s}=i;try{if("clear"===s.method){const{id:r,params:{timerId:o,timerType:i}}=s;if("interval"===i)(t=>{const r=e.get(t);if(void 0===r)throw new Error('There is no interval scheduled with the given id "'.concat(t,'".'));clearTimeout(r),e.delete(t)})(o),postMessage({error:null,id:r});else{if("timeout"!==i)throw new Error('The given type "'.concat(i,'" is not supported'));(e=>{const r=t.get(e);if(void 0===r)throw new Error('There is no timeout scheduled with the given id "'.concat(e,'".'));clearTimeout(r),t.delete(e)})(o),postMessage({error:null,id:r})}}else{if("set"!==s.method)throw new Error('The given method "'.concat(s.method,'" is not supported'));{const{params:{delay:i,now:n,timerId:a,timerType:d}}=s;if("interval"===d)((t,i,s)=>{const{expected:n,remainingDelay:a}=r(t,s);e.set(i,setTimeout(o,a,e,i,n,"interval"))})(i,a,n);else{if("timeout"!==d)throw new Error('The given type "'.concat(d,'" is not supported'));((e,i,s)=>{const{expected:n,remainingDelay:a}=r(e,s);t.set(i,setTimeout(o,a,t,i,n,"timeout"))})(i,a,n)}}}}catch(e){postMessage({error:{message:e.message},id:s.id,result:null})}}))})();`;var se=Ne(Ce,_e),Ue=t=>se().clearInterval(t),Fe=t=>se().clearTimeout(t),Be=(t,e)=>se().setInterval(t,e),We=(t,e)=>se().setTimeout(t,e);var E=(typeof window=="undefined"?"undefined":typeof window)=="object";var g={setTimeout:E?setTimeout.bind(window):setTimeout,clearTimeout:E?clearTimeout.bind(window):clearTimeout,setInterval:E?setInterval.bind(window):setInterval,clearInterval:E?clearInterval.bind(window):clearInterval},dt={setTimeout:We,clearTimeout:Fe,setInterval:Be,clearInterval:Ue};function pt(){g.setTimeout=setTimeout,g.clearTimeout=clearTimeout,g.setInterval=setInterval,g.clearInterval=clearInterval}function He(t){g.setTimeout=t.setTimeout,g.clearTimeout=t.clearTimeout,g.setInterval=t.setInterval,g.clearInterval=t.clearInterval}var V={},Ge=class{constructor(e){this.closed=!1;this.mc=new MessageChannel;this.name=e,V[e]=V[e]||[],V[e].push(this),this.mc.port1.start(),this.mc.port2.start(),this.onStorage=this.onStorage.bind(this),window.addEventListener("storage",this.onStorage)}onStorage(e){if(e.storageArea!==window.localStorage||e.key.substring(0,this.name.length)!==this.name||e.newValue===null)return;let o=JSON.parse(e.newValue);this.mc.port2.postMessage(o)}postMessage(e){if(this.closed)throw new Error("InvalidStateError");let o=JSON.stringify(e),r=`${this.name}:${String(Date.now())}${String(Math.random())}`;window.localStorage.setItem(r,o),g.setTimeout(()=>{window.localStorage.removeItem(r)},500),V[this.name].forEach(l=>{l!==this&&l.mc.port2.postMessage(JSON.parse(o))})}close(){if(this.closed)return;this.closed=!0,this.mc.port1.close(),this.mc.port2.close(),window.removeEventListener("storage",this.onStorage);let e=V[this.name].indexOf(this);V[this.name].splice(e,1)}get onmessage(){return this.mc.port1.onmessage}set onmessage(e){this.mc.port1.onmessage=e}get onmessageerror(){return this.mc.port1.onmessageerror}set onmessageerror(e){this.mc.port1.onmessageerror=e}addEventListener(e,o){return this.mc.port1.addEventListener(e,o)}removeEventListener(e,o){return this.mc.port1.removeEventListener(e,o)}dispatchEvent(e){return this.mc.port1.dispatchEvent(e)}},qe=typeof window=="undefined"?void 0:typeof window.BroadcastChannel=="function"?window.BroadcastChannel:Ge;var h=()=>E?performance.now():Date.now();function Ve(){return h().toString(36).substring(2)}var m;(function(n){n[n.REGISTER=0]="REGISTER",n[n.DEREGISTER=1]="DEREGISTER",n[n.IDLE=2]="IDLE",n[n.ACTIVE=3]="ACTIVE",n[n.PROMPT=4]="PROMPT",n[n.START=5]="START",n[n.RESET=6]="RESET",n[n.PAUSE=7]="PAUSE",n[n.RESUME=8]="RESUME",n[n.MESSAGE=9]="MESSAGE"})(m||(m={}));var k;(function(r){r[r.PROMPTED=0]="PROMPTED",r[r.ACTIVE=1]="ACTIVE",r[r.IDLE=2]="IDLE"})(k||(k={}));var ve=class{constructor(e){this.token=Ve();this.registry=new Map;this.allIdle=!1;let{channelName:o}=e;this.options=e,this.channel=new qe(o),this.registry.set(this.token,1),this.channel.addEventListener("message",r=>{let{action:l,token:T,data:W}=r.data;switch(l){case 0:this.registry.set(T,1);break;case 1:this.registry.delete(T);break;case 2:this.idle(T);break;case 3:this.active(T);break;case 4:this.prompt(T);break;case 9:this.options.onMessage(W);break;case 5:this.options.start(!0);break;case 6:this.options.reset(!0);break;case 7:this.options.pause(!0);break;case 8:this.options.resume(!0);break}}),this.send(0)}prompt(e=this.token){this.registry.set(e,0);let o=[...this.registry.values()].every(r=>r===0);e===this.token&&this.send(4),o&&this.options.onPrompt()}idle(e=this.token){this.registry.set(e,2);let o=[...this.registry.values()].every(r=>r===2);e===this.token&&this.send(2),!this.allIdle&&o&&(this.allIdle=!0,this.options.onIdle())}active(e=this.token){this.registry.set(e,1);let o=[...this.registry.values()].some(r=>r===1);e===this.token&&this.send(3),this.allIdle&&o&&(this.allIdle=!1,this.options.onActive())}sync(){try{this.channel.postMessage({action:6,token:this.token})}catch{}}message(e){try{this.channel.postMessage({action:9,token:this.token,data:e})}catch{}}send(e){try{this.channel.postMessage({action:e,token:this.token})}catch{}}close(){this.send(1),this.channel.close()}};var je=E?document:null,Je=["mousemove","keydown","wheel","DOMMouseScroll","mousewheel","mousedown","touchstart","touchmove","MSPointerDown","MSPointerMove","visibilitychange"];import{useRef as ft,useEffect as Tt}from"react";function N(t){let e=ft(t);return Tt(()=>{e.current=t},[t]),e}function ze(t,e){let o;function r(...l){o&&clearTimeout(o),o=setTimeout(()=>{t(...l),o=null},e)}return r.cancel=function(){clearTimeout(o)},r}function ae(t,e){let o=0;return function(...r){let l=new Date().getTime();if(!(l-o<e))return o=l,t(...r)}}function Y({timeout:t=1e3*60*20,promptTimeout:e=0,element:o=je,events:r=Je,timers:l=void 0,immediateEvents:T=[],onPrompt:W=()=>{},onIdle:j=()=>{},onActive:Z=()=>{},onAction:a=()=>{},onMessage:n=()=>{},debounce:u=0,throttle:c=0,eventsThrottle:f=200,startOnMount:d=!0,startManually:S=!1,stopOnIdle:w=!1,crossTab:H=!1,syncTimers:J=0}={}){let z=p(h()),he=p(Date.now()),ce=p(h()),A=p(null),O=p(null),X=p(0),v=p(!0),R=p(!1),U=p(!0),$=p(!1),I=p(!1),y=p(0),P=p(0),D=p(null),s=p(null),C=N(t),ee=N(e),Xe=N(w),Ie=p(T),le=p(o),me=p([...new Set([...r,...T]).values()]),Ee=N(j),te=N(Z),be=N(W),re=N(n),x=p();_(()=>{x.current&&x.current.cancel&&x.current.cancel(),u>0?x.current=ze(a,u):c>0?x.current=ae(a,c):x.current=a},[a,c,u]);let ge=p();_(()=>{H&&J&&(ge.current=ae(()=>{s.current.sync()},J))},[H,J]);let L=()=>{D.current!==null&&(g.clearTimeout(D.current),D.current=null)},G=(i,M=!0)=>{L(),D.current=g.setTimeout(de,i||C.current),M&&(O.current=h())},ye=i=>{y.current=0,P.current=h(),I.current=!0,G(ee.current,!1),be.current(i)},we=()=>{v.current=!0,A.current=h(),Xe.current?(L(),B()):I.current&&(P.current=0,I.current=!1),Ee.current()},xe=i=>{I.current=!1,P.current=0,v.current=!1,X.current+=h()-A.current,F(),G(),te.current(i)},de=i=>{if(!v.current){if(ee.current>0&&!I.current){s.current?s.current.prompt():ye(i);return}s.current?s.current.idle():we();return}s.current?s.current.active():xe(i)},Me=i=>{if(x.current(i),I.current)return;H&&J&&ge.current(),L();let M=h()-O.current;if((v.current&&!w||!v.current&&M>C.current)&&de(i),R.current=!1,y.current=0,P.current=0,!v.current&&Ie.current.includes(i.type)){de(i);return}G(),s.current&&s.current.active()},ne=p();_(()=>{let i=$.current;i&&B(),f>0?ne.current=ae(Me,f):ne.current=Me,i&&F()},[f,H,J]);let F=()=>{!E||$.current||(me.current.forEach(i=>{le.current.addEventListener(i,ne.current,{capture:!0,passive:!0})}),$.current=!0)},B=(i=!1)=>{!E||($.current||i)&&(me.current.forEach(M=>{le.current.removeEventListener(M,ne.current,{capture:!0})}),$.current=!1)},q=b(i=>{L(),F(),I.current&&te.current(),v.current=!1,I.current=!1,R.current=!1,y.current=0,P.current=0,s.current&&!i&&(s.current.active(),s.current.send(m.START)),G()},[D,v,C,s]),oe=b(i=>{L(),F(),(v.current||I.current)&&(te.current(),s.current&&s.current.active()),v.current=!1,I.current=!1,R.current=!1,y.current=0,P.current=0,ce.current=h(),s.current&&(s.current.allIdle=!1,i||s.current.send(m.RESET)),G()},[D,v,C,s]),pe=b((i=!1)=>R.current?!1:(y.current=Se(),R.current=!0,B(),L(),s.current&&(i||s.current.send(m.PAUSE)),!0),[D,s]),fe=b((i=!1)=>R.current?(R.current=!1,I.current||F(),v.current||G(y.current),P.current&&(P.current=h()),s.current&&(i||s.current.send(m.RESUME)),!0):!1,[D,C,y,s]),$e=b((i,M)=>{s.current?(M&&re.current(i),s.current.message(i)):M&&re.current(i)},[n]),Ye=b(()=>v.current,[v]),Ke=b(()=>I.current,[I]),Se=b(()=>{if(R.current)return y.current;let i=y.current?y.current:I.current?ee.current:C.current,M=O.current?I.current?h()-P.current:h()-O.current:0,Pe=Math.ceil(i-M);return Pe<0?0:Math.abs(Pe)},[C,ee,I,y,O]),Qe=b(()=>Math.round(h()-ce.current),[ce]),ke=b(()=>Math.round(h()-z.current),[z]),Ze=b(()=>A.current?new Date(he.current-z.current+A.current):null,[A]),et=b(()=>O.current?new Date(he.current-z.current+O.current):null,[O]),Re=b(()=>v.current?Math.round(h()-A.current+X.current):Math.round(X.current),[A,X]),tt=b(()=>{let i=Math.round(ke()-Re());return i>=0?i:0},[z,A,X]);return _(()=>{if(u>0&&c>0)throw new Error("\u274C onAction can either be throttled or debounced, not both.");l&&He(l);let i=()=>{s.current&&s.current.close(),x.current.cancel&&x.current.cancel(),L(),B(!0)};return E&&window.addEventListener("beforeunload",i),()=>{E&&window.removeEventListener("beforeunload",i),s.current&&s.current.close(),x.current.cancel&&x.current.cancel(),L(),B(!0)}},[]),_(()=>{s.current&&s.current.close(),H?s.current=new ve({channelName:"idle-timer",onPrompt:()=>{ye()},onIdle:()=>{we()},onActive:()=>{xe()},onMessage:re.current,start:q,reset:oe,pause:pe,resume:fe}):s.current=null},[H,be,Ee,te,re,q,oe,pe,fe]),_(()=>{L(),B(!0),U.current||(R.current=!0,v.current=!0,y.current=0),!S&&(d?q():F())},[S,d,U]),_(()=>{if(!U.current){let i=[...new Set([...r,...T]).values()];if(B(),me.current=i,le.current=o,Ie.current=T,S)return;d?q():F()}},[o,JSON.stringify(r),JSON.stringify(T),U,S,d]),_(()=>{if(U.current)U.current=!1;else{if(C.current=t,S)return;v.current?oe():q()}},[t,S,U,v]),{message:$e,start:q,reset:oe,pause:pe,resume:fe,isIdle:Ye,isPrompted:Ke,getRemainingTime:Se,getElapsedTime:Qe,getTotalElapsedTime:ke,getLastIdleTime:Ze,getLastActiveTime:et,getTotalIdleTime:Re,getTotalActiveTime:tt}}import vt,{createContext as ht,useContext as It}from"react";var ue=ht(null);function Et(t){let e=Y(t);return vt.createElement(ue.Provider,{value:e},t.children)}var bt=ue.Consumer;function gt(){return It(ue)}export{bt as IdleTimerConsumer,ue as IdleTimerContext,Et as IdleTimerProvider,pt as createMocks,Y as useIdleTimer,gt as useIdleTimerContext,mt as withIdleTimer,dt as workerTimers};
